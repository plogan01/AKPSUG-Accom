[~[tlist_sql;SELECT
    s.schoolid,
    s.lastfirst,
    s.dcid,
    s.grade_level,
    s.home_room,
    CASE x.lep
        WHEN 'L1' THEN 'Y'
        WHEN 'LP' THEN 'Y'
        ELSE 'N'
    END AS ELL,
    CASE 
        WHEN (x.disability_code > 0 AND x.disability_code < 15) THEN 'Y'
        ELSE 'N'
    END AS SP,
    CASE 
        WHEN peaks.testtype IS NULL THEN def.testtype
        ELSE peaks.testtype
    END AS testtype,
    CASE 
    WHEN peaks.ELA_TTS IS NOT NULL AND (peaks.testtype = 'C' OR (peaks.testtype IS NULL AND def.testtype = 'C')) THEN peaks.ELA_TTS
    ELSE 'N'
  END AS "ELATTS",
  CASE 
    WHEN peaks.ELA_OTHER IS NOT NULL AND (peaks.testtype = 'C' OR (peaks.testtype IS NULL AND def.testtype = 'C')) THEN peaks.ELA_OTHER
    ELSE 'N'
  END AS "ELAOther",
  CASE 
    WHEN peaks.ELA_AUDIO_CD IS NOT NULL AND (peaks.testtype = 'P' OR (peaks.testtype IS NULL AND def.testtype = 'P')) THEN peaks.ELA_AUDIO_CD
    ELSE 'N'
  END AS "ELACD",
  CASE 
    WHEN peaks.ELA_LARGE_PRINT IS NOT NULL AND (peaks.testtype = 'P' OR (peaks.testtype IS NULL AND def.testtype = 'P')) THEN peaks.ELA_LARGE_PRINT
    ELSE 'N'
  END AS "ELALargePrint",
  CASE 
    WHEN peaks.ELA_BRAILLE IS NOT NULL AND (peaks.testtype = 'P' OR (peaks.testtype IS NULL AND def.testtype = 'P')) THEN peaks.ELA_BRAILLE
    ELSE 'N'
  END AS "ELABraille",
  CASE 
    WHEN peaks.MATH_TTS IS NOT NULL AND (peaks.testtype = 'C' OR (peaks.testtype IS NULL AND def.testtype = 'C')) THEN peaks.MATH_TTS
    ELSE 'N'
  END AS "MATHTTS",
  CASE 
    WHEN peaks.MATH_OTHER IS NOT NULL AND (peaks.testtype = 'C' OR (peaks.testtype IS NULL AND def.testtype = 'C')) THEN peaks.MATH_OTHER
    ELSE 'N'
  END AS "MATHOther",
  CASE 
    WHEN peaks.MATH_AUDIO_CD IS NOT NULL AND (peaks.testtype = 'P' OR (peaks.testtype IS NULL AND def.testtype = 'P')) THEN peaks.MATH_AUDIO_CD
    ELSE 'N'
  END AS "MATHCD",
  CASE 
    WHEN peaks.MATH_LARGE_PRINT IS NOT NULL AND (peaks.testtype = 'P' OR (peaks.testtype IS NULL AND def.testtype = 'P')) THEN peaks.MATH_LARGE_PRINT
    ELSE 'N'
  END AS "MATHLarge",
  CASE 
    WHEN peaks.MATH_BRAILLE IS NOT NULL AND (peaks.testtype = 'P' OR (peaks.testtype IS NULL AND def.testtype = 'P')) THEN peaks.MATH_BRAILLE
    ELSE 'N'
  END AS "MATHBraille",
  CASE 
    WHEN peaks.SCIENCE_TTS IS NOT NULL AND (peaks.testtype = 'C' OR (peaks.testtype IS NULL AND def.testtype = 'C')) THEN peaks.SCIENCE_TTS
    ELSE 'N'
  END AS "SCIENCETTS",
  CASE 
    WHEN peaks.SCIENCE_OTHER IS NOT NULL AND (peaks.testtype = 'C' OR (peaks.testtype IS NULL AND def.testtype = 'C')) THEN peaks.SCIENCE_OTHER
    ELSE 'N'
  END AS "SCIENCEOther",
  CASE 
    WHEN peaks.SCIENCE_AUDIO_CD IS NOT NULL AND (peaks.testtype = 'P' OR (peaks.testtype IS NULL AND def.testtype = 'P')) THEN peaks.SCIENCE_AUDIO_CD
    ELSE 'N'
  END AS "SCIENCECD",
  CASE 
    WHEN peaks.SCIENCE_LARGE_PRINT IS NOT NULL AND (peaks.testtype = 'P' OR (peaks.testtype IS NULL AND def.testtype = 'P')) THEN peaks.SCIENCE_LARGE_PRINT
    ELSE 'N'
  END AS "SCIENCELarge",
  CASE 
    WHEN peaks.SCIENCE_BRAILLE IS NOT NULL AND (peaks.testtype = 'P' OR (peaks.testtype IS NULL AND def.testtype = 'P')) THEN peaks.SCIENCE_BRAILLE
    ELSE 'N'
  END AS "SCIENCEBraille",
  peaks.ELA_NON_EMBED,
  peaks.MATH_NON_EMBED,
  peaks.SCIENCE_NON_EMBED,
  sch.name

FROM Students s
JOIN Schools sch
    ON s.schoolid = sch.school_number
LEFT OUTER JOIN S_AK_STU_X x
    ON s.dcid = x.studentsdcid
LEFT OUTER JOIN U_PEAKS_DEFAULTS def
    ON s.schoolid = def.schoolid
LEFT OUTER JOIN U_PEAKS peaks
    ON s.dcid = peaks.studentsdcid

WHERE sch.state_excludefromreporting != 1
  AND s.enroll_status = 0
  AND s.grade_level IN (3,4,5,6,7,8,9,10)  
    
  {
    
    "schoolid": "~(schoolid;json)",
    "name": "~(lastfirst;json)",
    "dcid": "~(dcid;json)",
    "grade": "~(grade_level;json)",
    "science":  "~(science;json)",
    "homeroom": "~(homeroom;json)"
  },
[/tlist_sql]{}]